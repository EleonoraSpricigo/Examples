{   "problem_data":{
        "problem_type": "train", 
        "echo_level":1
    },
    "processes":{
        "preprocessing_processes":[{
            "python_module": "data_reader_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "data_input"    : "data/training_in_raw.dat",
                "data_output"   : "data//training_out_raw.dat",
                "input_log_name"  : "input_preprocessing.json",
                "output_log_name" : "output_preprocessing.json"
            }
        },
        {
            "python_module": "divide_dataset_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "objective": "all",
                "proportion": 0.5
            }
        },
        {
            "python_module": "eliminate_constant_dimension_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "objective": "output",
                "output_log_name"  : "output_preprocessing.json"
            }
        },
        {
            "python_module": "normalization_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "objective": "output",
                "input_log_name"  : "input_preprocessing.json",
                "output_log_name" : "output_preprocessing.json",
                "normalization_type": "soft_zero_one"
            }
        },
	{
            "python_module": "flatten_vector_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "objective": "output",
                "output_log_name" : "output_preprocessing.json"
            }
        },
        
        {
            "python_module": "lookback_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "lookback"	   : 5,
                "input_log_name"  : "input_preprocessing.json",
                "output_log_name" : "output_preprocessing.json"
            }
        },
        {
            "python_module": "save_data_process",
            "kratos_module": "KratosMultiphysics.NeuralNetworkApplication",
            "parameters"   :{
                "input_file_name"          : "data//training_in",
                "output_file_name"         : "data//training_out",
                "format"                   : "pkl",
                "input_log_name" 	    : "input_preprocessing.json",
                "output_log_name" 	    : "output_preprocessing.json"
            }
        
        }

        ],
        "model_processes":[{
        "python_module" : "initiate_network_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "layer_type"          : "input_layer",
            "layer_parameters"    :{
            "layer_name"          : "input",
            "input_to_recurrent"  : true,
                "data_input"      : "data//training_in.pkl"  
            }  
        }},   
 
        {
        "python_module" : "add_layer_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "layer_type"          : "lstm_layer",
            "layer_parameters"    :{
            "units"         	   : 20,
            "return_sequences"    : true
        }  
        }},   
        {
        "python_module" : "add_layer_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "layer_type"          : "lstm_layer",
            "layer_parameters"    :{
            "units"         	   : 20,
            "return_sequences"    : false
        }  
        }},
        {
        "python_module" : "add_layer_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "layer_type"                   : "dense_layer",
            "layer_parameters"             :{
                "output_layer" 	     : true,
                "data_output"		     : "data//training_out.pkl",
                "activation"		     : "linear"
        }}},  
        {
        "python_module" : "save_model_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "model_name"          : "my_model",
            "format"              : "SavedModel"
        }}],
        "training_processes":[{
        "python_module" : "custom_loss_function_compiler",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{  
            "loss_function" : "MeanSquaredError"
        }},
        {
        "python_module" : "custom_optimizer_compiler",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{ 
            "optimizer"     : "Adam",
            "learning_rate" : 0.001,
            "decay"	     : 1e-3
        }},
        {
        "python_module" : "metric_compiler",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{ 
            "metric"     : "MeanSquaredError"
        }},
        {
        "python_module" : "set_callback_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{ 
            "callback_type"        : "early_stopping_callback",
            "callback_parameters"  : {
                "monitor"          : "mean_squared_error",
                "mode"             : "min",
                "verbose"          : 1,
                "patience"         : 200
            }
        }},
        {
        "python_module" : "train_saved_model_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "data_input"          : "data//training_in.pkl",
            "data_output"         : "data//training_out.pkl",
            "model"               : "my_model",
            "recurrent"	  		  : true,
            "epochs"              : 2000,
            "shuffle"	          : true,
            "training_log"        : true,
            "training_log_file"   : "history.dat" 
        }}]
    },
    "output_processes":{
        "output_processes":[{
        "python_module" : "history_plotter_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "history_file"               : "history.dat",
            "variables"                  : ["mean_squared_error"],
            "output_format"              : "png",
            "output_name"                : "training_plot",
            "axis"                       : "semilogx",
            "burn_up"                    : 10
        }},
        {
        "python_module" : "testing_timeseries_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "model"               : "my_model",
            "input_file"          : "data/training_in.pkl",
            "target_file"         : "data/training_out.pkl",
            "timesteps"           : 431,
            "lookback"            : 5,
            "echo"                : 1,
            "predictions_file"    : "data/predictions",
            "save_format"         : "npy"            
        }},
        {
        "python_module" : "invert_transformations_process",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "echo"                : 1,
            "input_file"	   : "data//training_in.pkl",
            "predictions_file"    : "data//predictions.npy",
            "input_file_name"	   : "data//input_corrected",
            "output_file_name"    : "data//output_corrected",
            "save_format"	   : "npy"            
        }},
        {
        "python_module" : "correlation_matrix_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "file"   			  : "data//training_out_raw.dat",
            "origin"			  : "output_generation",
            "variables"			  : ["VELOCITY_X", "VELOCITY_Y"],
            "vmin"				  : [-0.02, -0.02],
            "vmax"				  : [0.02, 0.02],
            "output_name"         : "correlation_matrix_raw_100Re",
            "output_format"       : "png"          
        }},
		{
        "python_module" : "correlation_matrix_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "file"   			  : "data//output_corrected.npy",
            "origin"			  : "prediction",
            "variables"			  : ["VELOCITY_X", "VELOCITY_Y"],
            "vmin"				  : [-0.02, -0.02],
            "vmax"				  : [0.02, 0.02],
            "output_name"         : "correlation_matrix_prediction_100Re",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "prediction_timeseries_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "input_variable"      : "Timesteps",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 1000,
            "training_timesteps"  : 250,
            "output_name"         : "bodyfitted_cylinder_100Re_node1000",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "prediction_timeseries_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "input_variable"      : "Timesteps",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 0,
            "training_timesteps"  : 125,
            "output_name"         : "bodyfitted_cylinder_100Re_node0000",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "prediction_timeseries_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "input_variable"      : "Timesteps",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 1401,
            "training_timesteps"  : 125,
            "output_name"         : "bodyfitted_cylinder_100Re_node1402",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "frequency_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 1401,
            "plot_zero_frequency" : false,
            "flatten_target"      : true,
            "training_timesteps"  : 125,
            "sampling_rate"       : 0.1,
            "output_name"         : "bodyfitted_cylinder_100Re_node_1402_frequency",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "prediction_timeseries_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "input_variable"      : "Timesteps",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 2820,
            "training_timesteps"  : 125,
            "output_name"         : "bodyfitted_cylinder_100Re_node2821",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "frequency_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 2820,
            "plot_zero_frequency" : false,
            "flatten_target"      : true,
            "training_timesteps"  : 125,
            "sampling_rate"       : 0.1,
            "output_name"         : "bodyfitted_cylinder_100Re_node_2821_frequency",
            "output_format"       : "png"          
        }},
        {
        "python_module" : "prediction_timeseries_plotter",
        "kratos_module" : "KratosMultiphysics.NeuralNetworkApplication",
        "parameters"    :{
            "predictions_file"    : "data//output_corrected.npy",
            "target_file"         : "data//training_out_raw.dat",
            "input_variable"      : "Timesteps",
            "variables"           : ["Velocity_X", "Velocity_Y"],
            "axis"                : "plot",
            "node_id"		   : 1,
            "training_timesteps"  : 215,
            "output_name"         : "bodyfitted_cylinder_velocity_node0001",
            "output_format"       : "png"          
        }}]
        }
}
